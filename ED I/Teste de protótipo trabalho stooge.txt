#include <stdio.h>
#include <stdlib.h>
#include <string.h>

// Definindo cÃ³digos de cor ANSI para formataÃ§Ã£o do texto no terminal
#define RESET "\033[0m"           
#define BOLD "\033[1m"            
#define UNDERLINE "\033[4m"       
#define GREEN "\033[32m"          
#define YELLOW "\033[33m"         
#define CYAN "\033[36m"           
#define MAGENTA "\033[35m"        
#define RED "\033[31m"            
#define BLUE "\033[34m"           
#define LIGHT_BLUE  "\033[94m"    
#define LIGHT_YELLOW  "\033[93m"  
#define LIGHT_CYAN   "\033[96m"   
#define LIGHT_GREEN   "\033[92m"  
#define PURPLE "\x1B[35m"         
#define ORANGE "\033[38;5;208m"   
#define DOURADO "\033[1;33m"      
#define BLACK "\033[0;30m"        

typedef struct Emoji {
    char simbolo[10];
    int popularidade;
    struct Emoji* prox;
    struct Emoji* ant;
} Emoji;

typedef struct ListaDuplamenteEncadeada {
    Emoji* cabeca;
    Emoji* cauda;
} ListaDuplamenteEncadeada;

void limpar() {
    printf("\n\n%sğŸ›‘ %sPressione ENTER para continuar... %sğŸ›‘%s: ", LIGHT_CYAN, LIGHT_YELLOW, LIGHT_CYAN, RESET);
    getchar();
    #ifdef _WIN32
        system("cls");
    #else
        system("clear");
    #endif
}

void limparbuffer() {
    int c;
    while ((c = getchar()) != '\n' && c != EOF);
}

Emoji* criarEmoji(const char* simbolo, int popularidade) {
    Emoji* novo = (Emoji*)malloc(sizeof(Emoji));
    if (novo != NULL) {
        strcpy(novo->simbolo, simbolo);
        novo->popularidade = popularidade;
        novo->prox = NULL;
        novo->ant = NULL;
    }
    return novo;
}

void adicionarEmoji(ListaDuplamenteEncadeada* lista, const char* simbolo, int popularidade) {
    Emoji* novo = criarEmoji(simbolo, popularidade);
    if (lista->cauda == NULL) {
        lista->cabeca = novo;
        lista->cauda = novo;
    } else {
        lista->cauda->prox = novo;
        novo->ant = lista->cauda;
        lista->cauda = novo;
    }
}

void imprimirLista(ListaDuplamenteEncadeada* lista) {
    Emoji* atual = lista->cabeca;
    while (atual != NULL) {
        printf("Emoji: %s | Popularidade: %d\n", atual->simbolo, atual->popularidade);
        atual = atual->prox;
    }
}

Emoji* Remove_elem(ListaDuplamenteEncadeada* Ptl, int popularidade, int *flag) {
    Emoji* atual = Ptl->cabeca;
    Emoji* aux;
    *flag = 0;

    while (atual != NULL) {
        if (atual->popularidade == popularidade) {
            printf(BLUE "ğŸ—‘ï¸ Removendo emoji(s) com popularidade %d...\n\n" RESET, popularidade);
            if (atual == Ptl->cabeca) {
                Ptl->cabeca = atual->prox;
                if (Ptl->cabeca != NULL) {
                    Ptl->cabeca->ant = NULL;
                }
            } else {
                atual->ant->prox = atual->prox;
                if (atual->prox != NULL) {
                    atual->prox->ant = atual->ant;
                }
            }
            if (atual == Ptl->cauda) {
                Ptl->cauda = atual->ant;
            }

            aux = atual;
            atual = atual->prox;
            free(aux);

            *flag = 1;
            printf(GREEN "âœ… Emoji(s) com popularidade %d removido com sucesso!\n" RESET, popularidade);
        } else {
            atual = atual->prox;
        }
    }

    if (*flag == 0) {
        printf(YELLOW "âŒ Nenhum emoji com popularidade %d encontrado para remoÃ§Ã£o.\n" RESET, popularidade);
    }

    return Ptl->cabeca;
}

int Consulta_elem(ListaDuplamenteEncadeada* Ptl, const char* emoji) {
    Emoji* atual = Ptl->cabeca;

    while (atual != NULL && strcmp(atual->simbolo, emoji) != 0) {
        atual = atual->prox;
    }

    if (atual == NULL) {
        printf("%sğŸ’”ğŸ˜¢ %sEmoji nÃ£o encontrado! %sğŸ˜­ğŸ’§ %s\n", RED, CYAN, BLUE, RESET);
        return 0;
    } else {
        printf("%sğŸ˜Šâ­ %sEmoji encontrado com sucesso! %sğŸ‰â­ %s\n\n", RED, GREEN, BLUE, RESET);
        printf("%sğŸŒŸğŸ”¥ %sEmoji: |------[%s]------| %sğŸš€ğŸŒˆ %s\n", RED, CYAN, atual->simbolo, MAGENTA, RESET);
        printf("%sğŸ’¥ğŸ’« %sPopularidade: %d %sâš¡ğŸŒ» %s\n\n", YELLOW, BLUE, atual->popularidade, MAGENTA, RESET);
        return 1;
    }
}

Emoji* Libera_lista(ListaDuplamenteEncadeada* Ptl) {
    Emoji* aux = Ptl->cabeca;

    while (aux != NULL) {
        Emoji* temp = aux;
        aux = aux->prox;
        free(temp);
    }

    Ptl->cauda = NULL;
    return Ptl->cabeca;
}

void trocar(Emoji* a, Emoji* b) {
    int tempPopularidade = a->popularidade;
    char tempSimbolo[10];
    strcpy(tempSimbolo, a->simbolo);

    a->popularidade = b->popularidade;
    strcpy(a->simbolo, b->simbolo);

    b->popularidade = tempPopularidade;
    strcpy(b->simbolo, tempSimbolo);
}

void stoogeSort(ListaDuplamenteEncadeada* Ptl, Emoji* l, Emoji* h) {
    if (l == NULL || h == NULL || l == h || l->prox == h) return;

    if (l->popularidade > h->popularidade) {
        trocar(l, h);
    }

    int tamanho = 1;
    Emoji* temp = l;
    while (temp != h) {
        tamanho++;
        temp = temp->prox;
    }

    if (tamanho > 2) {
        int umTerco = tamanho / 3;

        Emoji* primeiroTerco = l;
        for (int i = 0; i < umTerco; i++) {
            if (primeiroTerco != NULL) primeiroTerco = primeiroTerco->prox;
        }

        Emoji* doisTerco = h;
        for (int i = 0; i < umTerco; i++) {
            if (doisTerco != NULL) doisTerco = doisTerco->ant;
        }

        if (primeiroTerco != NULL) stoogeSort(Ptl, l, doisTerco);
        if (primeiroTerco != NULL && doisTerco != NULL) stoogeSort(Ptl, primeiroTerco, h);
        if (primeiroTerco != NULL) stoogeSort(Ptl, l, doisTerco);
    }
}

void ordenarLista(ListaDuplamenteEncadeada* Ptl) {
    if (Ptl->cabeca && Ptl->cauda) {
        printf(CYAN "ğŸ”„ Lista Inicial:\n" RESET);
        imprimirLista(Ptl);
        printf("\n");

        limpar();

        printf(YELLOW "ğŸš€ Iniciando a ordenaÃ§Ã£o com Stooge Sort...\n\n" RESET);
        stoogeSort(Ptl, Ptl->cabeca, Ptl->cauda);

        printf(GREEN "âœ… Lista Ordenada:\n" RESET);
        imprimirLista(Ptl);
        printf("\n");
    } else {
        printf(RED "âŒ A lista estÃ¡ vazia ou nÃ£o estÃ¡ corretamente inicializada.\n" RESET);
    }
}

// FunÃ§Ã£o para exibir mensagens de boas-vindas sobre uma lista de emojis
void boasVindas() {
    // Exibe uma borda superior da caixa de boas-vindas
    printf("\n" GREEN BOLD "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" RESET "\n");
    // Mensagem de boas-vindas com destaque para a "Lista de Emojis"
    printf(GREEN BOLD "â•‘" RESET " ğŸŒŸğŸ‰ " BOLD GREEN "Bem-vindo Ã  " RESET GREEN BOLD "Lista de Emojis do Zap" RESET GREEN BOLD " ğŸ‰ğŸŒŸ " GREEN BOLD "                              â•‘" RESET "\n");
    // Mensagem sobre explorar emojis
    printf(GREEN BOLD "â•‘" RESET " ğŸ˜€ğŸ˜ " YELLOW "Explore uma seleÃ§Ã£o divertida de emojis para usar!" RESET GREEN BOLD " ğŸ˜ğŸ˜€ " GREEN BOLD "              â•‘" RESET "\n");
    // Mensagem sobre escolher Ã­cones e expressÃµes
    printf(GREEN BOLD "â•‘" RESET " ğŸ¨ğŸ–¼ï¸ " MAGENTA "Escolha entre uma variedade de Ã­cones e expressÃµes!" RESET GREEN BOLD " ğŸ–¼ï¸ğŸ¨ " GREEN BOLD "             â•‘" RESET "\n");
    // Mensagem sobre personalizaÃ§Ã£o com emojis
    printf(GREEN BOLD "â•‘" RESET " ğŸ› ï¸âœ¨ " GREEN "Personalize suas mensagens com emojis Ãºnicos!" RESET GREEN BOLD " âœ¨ğŸ› ï¸ " GREEN BOLD "                   â•‘" RESET "\n");
    // Exibe uma borda inferior da caixa de boas-vindas
    printf(GREEN BOLD "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" RESET "\n\n");
}

int main() {
    ListaDuplamenteEncadeada* lista = (ListaDuplamenteEncadeada*)malloc(sizeof(ListaDuplamenteEncadeada));
    if (lista == NULL) {
        printf(RED "âŒ Erro ao alocar memÃ³ria para a lista.\n" RESET);
        return 1;
    }

    lista->cabeca = NULL;
    lista->cauda = NULL;

    boasVindas();

    adicionarEmoji(lista, "ğŸ˜€", 10);
    adicionarEmoji(lista, "ğŸ˜‚", 20);
    adicionarEmoji(lista, "ğŸ¥º", 5);
    adicionarEmoji(lista, "ğŸ˜", 15);
    adicionarEmoji(lista, "ğŸ¥³", 25);

    ordenarLista(lista);

    const char* emojiParaConsultar = "ğŸ˜‚";
    printf(CYAN "\nğŸ” Consultando o emoji: %s\n" RESET, emojiParaConsultar);
    Consulta_elem(lista, emojiParaConsultar);

    int flag;
    int popularidadeParaRemover = 15;
    printf(CYAN "\nğŸ—‘ï¸ Removendo emojis com popularidade: %d\n" RESET, popularidadeParaRemover);
    Remove_elem(lista, popularidadeParaRemover, &flag);

    printf(CYAN "\nğŸ”„ Lista apÃ³s remoÃ§Ã£o:\n" RESET);
    imprimirLista(lista);

    Libera_lista(lista);
    free(lista);

    return 0;
}
