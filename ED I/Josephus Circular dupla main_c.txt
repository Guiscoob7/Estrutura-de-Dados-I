#include "funcoes.h"
#include <stdio.h>
#include <stdlib.h>
#include <time.h>

// FunÃ§Ã£o principal
int main() {
    srand(time(NULL));  // Inicializa a semente do gerador de nÃºmeros aleatÃ³rios com o tempo atual
    boasVindas();  // Exibe a mensagem de boas-vindas
    limpar();      // Limpa a tela

    int opcao, suicidio, cont, posicao = 0;  // VariÃ¡veis de controle e posiÃ§Ã£o
    char nome[50];  // Buffer para armazenar o nome do participante
    Pessoa *lista_suicidas; // Ponteiro para a lista de pessoas participantes
    lista_suicidas = Cria_lista(); // Cria a lista de participantes
    limpar();       // Limpa a tela para melhor visualizaÃ§Ã£o

    // Loop para inserir participantes
    do {
        // Solicita ao usuÃ¡rio para inserir o nome de um participante
        printf("\n%s%sğŸ—‚ï¸ %sPor favor, insira o nome do%s%s %ssuicida%s%s que deseja participar:%s ",
               CYAN, BOLD, RESET, BOLD, GREEN, RESET, BOLD, RED, RESET);
        scanf("%49[^\n]", nome);  // LÃª o nome do participante (mÃ¡x. 49 caracteres)
        limparbuffer();  // Limpa o buffer de entrada para evitar problemas na leitura
        limpar();        // Limpa a tela
        lista_suicidas = Insere_elem(lista_suicidas, nome);  // Insere o participante na lista
        printf("%sâœ… Suicida adicionado com sucesso!%s\n", GREEN, RESET);  // ConfirmaÃ§Ã£o de sucesso
        limpar();  // Limpa a tela
        // Pergunta ao usuÃ¡rio se deseja adicionar mais participantes
        printf("\n%sğŸ“‹ VocÃª deseja inserir mais?%s\n%s\n[1] - Sim%s\t%s[0] - NÃ£o%s\n\n%sEscolha: %s" ,
               PURPLE, RESET, GREEN, RESET, RED, RESET, ORANGE, RESET);
        scanf("%d", &opcao);  // LÃª a opÃ§Ã£o escolhida pelo usuÃ¡rio
        limparbuffer();  // Limpa o buffer de entrada
        limpar();  // Limpa a tela
    } while (opcao == 1);  // Continua o loop enquanto o usuÃ¡rio escolher "1" (Sim)
    
    printf("%sâŒ InserÃ§Ã£o Finalizada!%s\n", RED, RESET);  // Indica que a inserÃ§Ã£o de participantes foi finalizada
    Exibir_lista(lista_suicidas);  // Exibe a lista de participantes inseridos
    printf("%sğŸ® Hora de Jogar! ğŸ®%s\n", ORANGE, RESET);  // Indica o inÃ­cio do jogo
    limpar();  // Limpa a tela

    // Loop do jogo atÃ© que reste apenas uma pessoa na lista
    while (Tamanho_Lista(lista_suicidas) > 1) {
        Exibir_lista(lista_suicidas);  // Exibe a lista atualizada de participantes
        suicidio = rand() % Tamanho_Lista(lista_suicidas) + 1;  // Sorteia uma posiÃ§Ã£o aleatÃ³ria
        printf("\n%sğŸ²ğŸ° Sorteando NÃºmero... ğŸ°ğŸ²%s\n\n", YELLOW, RESET);
        printf("%sğŸ€âœ¨ O nÃºmero sorteado Ã©: %d âœ¨ğŸ€%s\n", GREEN, suicidio, RESET);  // Exibe o nÃºmero sorteado
        if (posicao) {
            // Informa a Ãºltima posiÃ§Ã£o de onde a pessoa foi eliminada, se houver
            printf("\n%sğŸ’¥âš”ï¸ A Ãºltima pessoa sorteada estava na posiÃ§Ã£o %d... âš”ï¸ğŸ’¥%s\n\n", RED, posicao, RESET);
        }
        limpar();  // Limpa a tela
        lista_suicidas = Remove_elem(lista_suicidas, suicidio, &posicao);  // Remove o participante sorteado
        limpar();  // Limpa a tela
    }

    // Quando sobrar apenas um participante, exibe a mensagem de ganhador
    printf("%sğŸ†ğŸ¥³ Temos um Ganhador! ğŸ¥³ğŸ†%s\n\n", BLUE, RESET);
    printf("%sğŸ…âœ¨ O ganhador(a) Ã© %s! âœ¨ğŸ…%s\n\n", DOURADO, lista_suicidas->nome, RESET);
    printf("%sğŸ‰ğŸŠ ParabÃ©ns! ğŸŠğŸ‰%s\n", MAGENTA, RESET);  // Parabeniza o ganhador

    Salvar_Ganhador(lista_suicidas);  // Salva o nome do ganhador no arquivo
    Libera_lista(lista_suicidas);  // Libera a memÃ³ria alocada para a lista de participantes
    limpar();  // Limpa a tela
    printf("ğŸšª " BOLD "Saindo do programa..." RESET " ğŸšª\n");  // Mensagem de saÃ­da do programa

    return 0; // Finaliza o programa
}
