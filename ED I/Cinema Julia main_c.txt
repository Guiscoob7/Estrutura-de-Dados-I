#include "funcoes.h"
#include <stdio.h>
#include <stdlib.h>

// FunÃ§Ã£o principal
int main() {
    boasVindas();  // Exibe a mensagem de boas-vindas
    limpar();      // Limpa a tela

    int opcao, assento, aux = 0;
    char filme[50];
    Ingresso *lista_disponiveis, *lista_vendidos; // Inicializa os ponteiros para listas de ingressos
    lista_disponiveis = Cria_lista(); // Cria a lista de ingressos disponÃ­veis
    lista_vendidos = Cria_lista(); // Cria a lista de ingressos vendidos
    lista_disponiveis = inicializarFilmes(lista_disponiveis);

    do {
        // Exibe o menu de opÃ§Ãµes para o usuÃ¡rio
        printf("\n" CYAN BOLD "ğŸ¬ğŸ¿ Menu Cinema: ğŸ¿ğŸ¬" RESET "\n");
        printf("ğŸŒŸ " BOLD GREEN "[1]" RESET " ğŸŸï¸ " BOLD MAGENTA "Vender Ingresso" RESET " ğŸŸï¸\n");
        printf("ğŸŒŸ " BOLD GREEN "[2]" RESET " ğŸ”„ " BOLD YELLOW "Cancelar Ingresso" RESET " ğŸ”„\n");
        printf("ğŸŒŸ " BOLD GREEN "[3]" RESET " ğŸ—‚ï¸ " BOLD BLUE "Listar Ingressos DisponÃ­veis" RESET " ğŸ—‚ï¸\n");
        printf("ğŸŒŸ " BOLD GREEN "[4]" RESET " ğŸ“œ " BOLD CYAN "Consultar Ingressos Vendidos" RESET " ğŸ“œ\n");
        printf("ğŸŒŸ " BOLD GREEN "[5]" RESET " ğŸšª " BOLD "Sair" RESET " ğŸšª\n");

        // Solicita ao usuÃ¡rio a opÃ§Ã£o desejada
        printf("\n" CYAN BOLD "Escolha uma opÃ§Ã£o: " RESET);
        scanf("%d", &opcao);
        limparbuffer(); // Limpa o buffer do teclado para evitar problemas com entrada de dados
        limpar();       // Limpa a tela para uma melhor visualizaÃ§Ã£o

        // Processa a opÃ§Ã£o escolhida pelo usuÃ¡rio
        switch (opcao) {
            case 1: {
                // Vender Ingresso
                printf(BOLD MAGENTA "\nğŸŸï¸ Vender Ingresso ğŸŸï¸\n" RESET);
                limpar();
                printf(BOLD MAGENTA "\nğŸ—‚ï¸ Lista de Ingressos DisponÃ­veis ğŸ—‚ï¸\n\n" RESET);
                Exibir_lista_total(lista_disponiveis);
                printf("\n%s%sğŸ—‚ï¸ %sPor favor, insira o nome do%s%s %sfilme%s%s que deseja comprar ingressos:%s ",
                   CYAN, BOLD, RESET, BOLD, GREEN, RESET, BOLD, RED, RESET);
                scanf("%49[^\n]", filme);
                limparbuffer();
                limpar();
                printf(BOLD MAGENTA "\nğŸ—‚ï¸ Lista de Ingressos DisponÃ­veis ğŸ—‚ï¸\n\n" RESET);
                Exibir_lista(lista_disponiveis, filme, &aux); // Exibe todos os ingressos disponÃ­veis
                if (aux){
                    printf("\n%s%sğŸ”¢ %sPor favor, insira o nÃºmero do%s%s %sassento%s%s que deseja comprar:%s ",
                    CYAN, BOLD, RESET, BOLD, GREEN, RESET, BOLD, RED, RESET);
                    scanf("%d", &assento);
                    limparbuffer();
                    printf("\n%sğŸ“‹ VocÃª tem certeza?%s\n%s\n[1] - Sim%s\t%s[0] - NÃ£o%s\n\n%sEscolha: %s" ,PURPLE, RESET, GREEN, RESET, RED, RESET, ORANGE, RESET);
                    scanf("%d", &opcao);
                    limparbuffer();
                    if (opcao == 1) {
                        lista_disponiveis = Remove_elem(lista_disponiveis, assento, filme, &aux);
                        if (aux) {
                            // Exibe a confirmaÃ§Ã£o de operaÃ§Ã£o
                            printf("\n%sğŸ—‘ï¸ Comprando o Ingresso nÂº %d....%s\n", LIGHT_YELLOW, assento, RESET);
                            // Mensagem de sucesso
                            printf("%sâœ… Ingresso vendido com sucesso!%s\n", GREEN, RESET);
                            lista_vendidos = Insere_elem(lista_vendidos, assento, filme);
                        }
                    } else {
                        printf("%sâŒ Venda cancelada!%s\n", RED, RESET);
                    }
                }
                limpar();
                break;
            }
            case 2:
                // Cancelar Ingresso
                printf(BOLD MAGENTA "\nğŸ”„ Cancelar Ingresso ğŸ”„\n" RESET);
                limpar();
                printf("\n%s%sğŸ“œ %sPor favor, insira o nome do%s%s %sfilme%s%s que deseja cancelar ingresso:%s ",
                   CYAN, BOLD, RESET, BOLD, GREEN, RESET, BOLD, RED, RESET);
                scanf("%49[^\n]", filme);
                limparbuffer();
                Exibir_lista(lista_vendidos, filme, &aux); // Exibe a lista atual de ingressos vendidos
                if (aux){
                    printf("\n%s%sğŸ”¢ %sPor favor, insira o nÃºmero do%s%s %sassento%s%s do ingresso que deseja cancelar:%s ",
                    CYAN, BOLD, RESET, BOLD, GREEN, RESET, BOLD, RED, RESET);
                    scanf("%d", &assento);
                    limparbuffer();
                    printf("\n%sğŸ“‹ VocÃª tem certeza?%s\n%s\n[1] - Sim%s\t%s[0] - NÃ£o%s\n\n%sEscolha: %s" ,PURPLE, RESET, GREEN, RESET, RED, RESET, ORANGE, RESET);
                    scanf("%d", &opcao);
                    limparbuffer();
                    if (opcao == 1) {
                        lista_vendidos = Remove_elem(lista_vendidos, assento, filme, &aux);
                        if (aux) {
                            // Exibe a confirmaÃ§Ã£o de operaÃ§Ã£o
                            printf("\n%sğŸ—‘ï¸ Cancelando o Ingresso nÂº %d....%s\n", LIGHT_YELLOW, assento, RESET);
                            // Mensagem de sucesso
                            printf("%sâœ… Ingresso cancelado com sucesso!%s\n", GREEN, RESET);
                            lista_disponiveis = Insere_elem(lista_disponiveis, assento, filme);
                        }
                    } else {
                        printf("%sâŒ Cancelamento cancelado!%s\n", RED, RESET);
                    }
                }
                limpar();
                break;
            case 3:
                // Listar Ingressos DisponÃ­veis
                printf(BOLD MAGENTA "\nğŸ—‚ï¸ Listar Ingressos DisponÃ­veis ğŸ—‚ï¸\n" RESET);
                limpar();
                Exibir_lista_total(lista_disponiveis);
                printf("\n%s%sğŸ” %sPor favor, insira o nome do%s%s %sfilme%s%s que deseja ver ingressos disponÃ­veis:%s ",
                   CYAN, BOLD, RESET, BOLD, GREEN, RESET, BOLD, RED, RESET);
                scanf("%49[^\n]", filme);
                limparbuffer();
                printf(BOLD MAGENTA "\nğŸ—‚ï¸ Lista de Ingressos DisponÃ­veis ğŸ—‚ï¸\n" RESET);
                limpar();
                lista_disponiveis = Ordenar(lista_disponiveis);
                Exibir_lista(lista_disponiveis, filme, &aux); // Exibe todos os ingressos disponÃ­veis
                limpar();
                break;
            case 4:
                // Consultar Ingressos Vendidos
                printf(BOLD MAGENTA "\nğŸ“œ Listar Ingressos Vendidos ğŸ“œ\n" RESET);
                limpar();
                printf(BOLD MAGENTA "\nğŸ“œ Lista de Ingressos Vendidos ğŸ“œ\n\n" RESET);
                Exibir_lista_total(lista_vendidos); // Exibe a lista de ingressos vendidos
                limpar();
                break;
            case 5:
                // Sair do programa
                printf("ğŸšª " BOLD "Saindo do programa..." RESET " ğŸšª\n");
                lista_disponiveis = Libera_lista(lista_disponiveis); // Libera a memÃ³ria alocada para a lista de ingressos disponÃ­veis
                lista_vendidos = Libera_lista(lista_vendidos); // Libera a memÃ³ria alocada para a lista de ingressos vendidos
                limpar();
                break;
            default:
                // OpÃ§Ã£o invÃ¡lida fornecida pelo usuÃ¡rio
                printf(RED BOLD "âš ï¸ OpÃ§Ã£o invÃ¡lida. Por favor, escolha um nÃºmero de 1 a 5. âš ï¸" RESET "\n");
                break;
        }
    } while (opcao != 5); // Loop atÃ© que o usuÃ¡rio escolha sair

    return 0; // Finaliza o programa
}
